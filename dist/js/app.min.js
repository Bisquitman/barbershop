(()=>{"use strict";const e=e=>{e.classList.add("preload")},t=e=>{e.classList.remove("preload")},n="https://checker-wiry-flood.glitch.me";window.addEventListener("DOMContentLoaded",(()=>{!function(e){let t=new Image;t.onload=t.onerror=function(){1==(2==t.height)?document.querySelector("html").classList.add("webp"):document.querySelector("html").classList.add("no-webp")},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}(),(()=>{const n=document.querySelector(".slider"),a=document.querySelector(".slider__container");a.style.display="none",e(n),window.addEventListener("load",(()=>{t(n),a.style.display="",(()=>{const e=document.querySelectorAll(".slider__item"),t=document.querySelector(".slider__list"),n=document.querySelector(".slider__arrow_left"),a=document.querySelector(".slider__arrow_right");let s=1,i=0;const r=()=>{s+2===e.length&&document.documentElement.offsetWidth>560||s===e.length?a.style.display="none":a.style.display="",n.style.display=1===s?"none":""};r(),n.addEventListener("click",(()=>{e[s]?.classList.remove("slider__item_active"),i=-e[0].clientWidth*(s-2),t.style.transform=`translateX(${i}px)`,s-=1,e[s]?.classList.add("slider__item_active"),r()})),a.addEventListener("click",(()=>{e[s]?.classList.remove("slider__item_active"),i=-e[0].clientWidth*s,t.style.transform=`translateX(${i}px)`,s+=1,e[s]?.classList.add("slider__item_active"),r()})),window.addEventListener("resize",(()=>{s+2>e.length&&document.documentElement.offsetWidth>560&&(s=e.length-2,e[s]?.classList.add("slider__item_active")),i=-e[0].clientWidth*(s-1),t.style.transform=`translateX(${i}px)`,r()}))})()}))})(),(()=>{(()=>{const a=document.querySelector(".price__list"),s=document.querySelector(".reserve__fieldset_service");a.textContent="",e(a),s.innerHTML='<legend class="reserve__legend">Услуга</legend>',fetch(`${n}/api`).then((e=>e.json())).then((e=>(((e,t)=>{t.forEach((t=>{const n=document.createElement("li");n.classList.add("price__item"),n.innerHTML=`\n        <span class="price__item-title">${t.name}</span><span class="price__item-count">${t.price} руб</span>\n      `,e.append(n)}))})(a,e),t(a),e))).then((e=>{((e,t)=>{const n=t.map((e=>{const t=document.createElement("label");return t.className="radio",t.innerHTML=`\n        <input type="radio" class="radio__input" name="service" value="${e.id}">\n        <span class="radio__label">${e.name}</span>\n      `,t}));e.append(...n)})(s,e),t(s)}))})();const a=e=>{e.forEach((e=>{e.disabled=!0}))},s=e=>{e.forEach((e=>{e.disabled=!1}))};(()=>{const i=document.querySelector(".reserve__form"),{fieldservice:r,fieldspec:l,fielddate:o,fieldmonth:c,fieldday:d,fieldtime:m,btn:p}=i;a([l,o,c,d,m,p]),i.addEventListener("change",(async({target:r})=>{if("service"===r.name){a([l,o,c,d,m,p]),l.innerHTML='<legend class="reserve__legend">Специалист</legend>',e(l);const i=await fetch(`${n}/api?service=${r.value}`),u=await i.json();((e,t)=>{const a=t.map((e=>{const t=document.createElement("label");return t.className="radio",t.innerHTML=`\n        <input type="radio" class="radio__input" name="spec" value="${e.id}">\n        <span class="radio__label radio__label_spec" style="--bg-image: url(${n}/${e.img})">${e.name}</span>\n      `,t}));e.append(...a)})(l,u),t(l),s([l])}if("spec"===r.name){a([o,c,d,m,p]),e(c);const r=await fetch(`${n}/api?spec=${i.spec.value}`),l=await r.json();c.textContent="",((e,t)=>{const n=t.map((e=>{const t=document.createElement("label");return t.className="radio",t.innerHTML=`\n        <input type="radio" class="radio__input" name="month" value="${e}">\n        <span class="radio__label">${new Intl.DateTimeFormat("ru-RU",{month:"long"}).format(new Date(e))}</span>\n      `,t}));e.append(...n)})(c,l),t(c),s([o,c])}if("month"===r.name){a([d,m,p]),e(d);const r=await fetch(`${n}/api?spec=${i.spec.value}&month=${i.month.value}`),l=await r.json();d.textContent="",((e,t,n)=>{const a=t.map((e=>{const t=document.createElement("label");return t.className="radio",t.innerHTML=`\n        <input type="radio" class="radio__input" name="day" value="${e}">\n        <span class="radio__label">${new Intl.DateTimeFormat("ru-RU",{month:"long",day:"numeric"}).format(new Date(`${n}/${e}`))}</span>\n      `,t}));e.append(...a)})(d,l,i.month.value),t(d),s([d])}if("day"===r.name){a([m,p]),e(m);const l=await fetch(`${n}/api?spec=${i.spec.value}&month=${i.month.value}&day=${r.value}`),o=await l.json();m.textContent="",((e,t)=>{t.sort(((e,t)=>e>t?1:-1));const n=t.map((e=>{const t=document.createElement("label");return t.className="radio",t.innerHTML=`\n        <input type="radio" class="radio__input" name="time" value="${e}">\n        <span class="radio__label">${e}</span>\n      `,t}));e.append(...n)})(m,o),t(m),s([m])}"time"===r.name&&s([p])})),i.addEventListener("submit",(async e=>{e.preventDefault();const t=new FormData(i),s=JSON.stringify(Object.fromEntries(t)),u=await fetch(`${n}/api/order`,{method:"POST",body:s}),_=await u.json();a([r,l,o,c,d,m,p]);const y=document.createElement("p");y.className="reserve__success",y.innerHTML=`\n        Спасибо за бронь #<strong>${_.id}</strong>!<br>\n        Ждём вас <strong>${new Intl.DateTimeFormat("ru-RU",{month:"long",day:"numeric"}).format(new Date(`${_.month}/${_.day}`))}</strong>, \n        время: <strong>${_.time}</strong>.\n      `,i.append(y)}))})()})()}))})();